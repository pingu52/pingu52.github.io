---
import type { GetStaticPaths } from "astro";
import { PAGE_SIZE } from "@constants/constants";
import I18nKey from "@i18n/i18nKey";
import { i18n, i18nFormat } from "@i18n/translation";
import { getSortedPosts } from "@utils/content-utils";
import TaxonomyFeedPage from "@components/TaxonomyFeedPage.astro";
import { UNCATEGORIZED_SLUG, buildCategoryStaticPaths, decodeTaxonomySegment } from "@utils/taxonomy-utils";

export const getStaticPaths = (async ({ paginate }) => {
	const allBlogPosts = await getSortedPosts();
	return buildCategoryStaticPaths(paginate, allBlogPosts, PAGE_SIZE);
}) satisfies GetStaticPaths;

const { page, taxonomyTitle } = Astro.props;

const categoryParam = Astro.params.category ?? "";
const categoryTitle =
	categoryParam === UNCATEGORIZED_SLUG
		? i18n(I18nKey.uncategorized)
		: (typeof taxonomyTitle === "string" && taxonomyTitle !== "" ? taxonomyTitle : decodeTaxonomySegment(categoryParam));
---

<TaxonomyFeedPage
	title={categoryTitle}
	page={page}
	description={i18nFormat(I18nKey.taxonomyCategoryDescription, { name: categoryTitle })}
/>
