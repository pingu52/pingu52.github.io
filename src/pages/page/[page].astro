---
import BaseLayout from "@/layouts/BaseLayout.astro";
import PostListItem from "@/components/PostListItem.astro";
import Pagination from "@/components/Pagination.astro";
import { getAllPosts } from "@/lib/posts";

const PAGE_SIZE = 10;

export async function getStaticPaths() {
  const posts = await getAllPosts();
  const totalPages = Math.max(1, Math.ceil(posts.length / PAGE_SIZE));

  return Array.from({ length: totalPages }, (_, i) => {
    const page = i + 1;
    const start = i * PAGE_SIZE;
    const end = start + PAGE_SIZE;

    return {
      params: { page: String(page) },
      props: {
        totalPages,
        currentPage: page,
        pagePosts: posts.slice(start, end),
      },
    };
  });
}

const { totalPages, currentPage, pagePosts } = Astro.props as {
  totalPages: number;
  currentPage: number;
  pagePosts: any[];
};
---

<BaseLayout title={`pingu52 | Page ${currentPage}`}>
  <div class="card" style="padding: 18px;">
    <h1 class="page-title">전체 게시글</h1>

    <div class="post-list">
      {pagePosts.map((p) => (
        <PostListItem post={p} />
      ))}
    </div>

    <Pagination currentPage={currentPage} totalPages={totalPages} />
  </div>
</BaseLayout>
