---
import type { Post } from "@/lib/posts";
import { buildCategoryTree, collectTags, formatDate, getPostUrl } from "@/lib/posts";
import CategoryTree from "@/components/CategoryTree.astro";
import TagList from "@/components/TagList.astro";

const { posts } = Astro.props as { posts: Post[] };

const cats = buildCategoryTree(posts);
const tags = collectTags(posts);

const recent = posts.slice(0, 5);
const popular = posts.filter(p => p.data.popular).slice(0, 5);
---

<div class="sidebar-inner">
  <div class="profile card">
    <div class="row">
      <div class="avatar" aria-hidden="true"></div>
      <div>
        <div class="name">pingu52</div>
        <div class="bio">보안 / 임베디드 / 개발 기록</div>
      </div>
    </div>
  </div>

  <div class="section card">
    <div class="adbox">250x250 (Ad 자리)</div>
  </div>

  <nav class="section card category">
    <h2>카테고리</h2>
    <div class="cat">
      {cats.length ? (
        <CategoryTree nodes={cats} />
      ) : (
        <a href="/category/" style="color: var(--muted); font-size: 13px;">아직 카테고리가 없어요</a>
      )}
    </div>
  </nav>

  <div class="section card count">
    <h2>전체 방문자</h2>
    <p class="total">—</p>
    <p>Today : —</p>
    <p>Yesterday : —</p>
    <p style="margin-top:8px; font-size:12px; color: var(--muted);">
      * 방문자 카운트는 GitHub Pages 단독으로는 불가해서, 필요하면 GA4/Umami 같은 분석을 붙이면 돼요.
    </p>
  </div>

  <div class="section card tabs">
    <input id="tab-recent" type="radio" name="tab" checked />
    <input id="tab-popular" type="radio" name="tab" />
    <div class="tab-head">
      <label class="tab-btn" for="tab-recent">최근글</label>
      <label class="tab-btn" for="tab-popular">인기글</label>
    </div>

    <div class="tab-panels">
      <div id="panel-recent" class="tab-panel">
        <ul class="mini-list">
          {recent.map(p => (
            <li>
              <a href={getPostUrl(p)}>
                <div class="mini-thumb">
                  {p.data.thumbnail ? <img src={p.data.thumbnail} alt="" loading="lazy" /> : null}
                </div>
                <div>
                  <div class="mini-title">{p.data.title}</div>
                  <div class="mini-date">{formatDate(p.data.pubDate)}</div>
                </div>
              </a>
            </li>
          ))}
        </ul>
      </div>

      <div id="panel-popular" class="tab-panel">
        {popular.length ? (
          <ul class="mini-list">
            {popular.map(p => (
              <li>
                <a href={getPostUrl(p)}>
                  <div class="mini-thumb">
                    {p.data.thumbnail ? <img src={p.data.thumbnail} alt="" loading="lazy" /> : null}
                  </div>
                  <div>
                    <div class="mini-title">{p.data.title}</div>
                    <div class="mini-date">{formatDate(p.data.pubDate)}</div>
                  </div>
                </a>
              </li>
            ))}
          </ul>
        ) : (
          <div style="color: var(--muted); font-size: 13px;">popular: true 로 지정된 글이 없어요</div>
        )}
      </div>
    </div>
  </div>

  <div class="section card">
    <h2>태그</h2>
    <TagList tags={tags} />
  </div>

  <div class="section card">
    <div class="adbox">반응형 (Ad 자리)</div>
  </div>
</div>

